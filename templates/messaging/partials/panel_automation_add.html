{% load i18n djicons %}

<form hx-post="{% url 'messaging:automation_add' %}"
      hx-target="#automations-list"
      @htmx:after-request="closePanel()">
    {% csrf_token %}

    <div class="side-sheet-header">
        <h2 class="side-sheet-title">{% trans "New Automation" %}</h2>
        <button type="button" class="side-sheet-close" @click="closePanel()">
            {% icon "close-outline" %}
        </button>
    </div>

    <div class="side-sheet-body">
        <div class="form-group">
            <label class="form-group-label">{% trans "Name" %} *</label>
            <input type="text" name="name" class="input" required placeholder="{% trans 'e.g., Welcome new customers' %}">
        </div>

        <div class="form-group">
            <label class="form-group-label">{% trans "Description" %}</label>
            <textarea name="description" class="textarea" rows="2"></textarea>
        </div>

        <div class="form-group">
            <label class="form-group-label">{% trans "Trigger" %} *</label>
            <select name="trigger" class="select" required>
                {% for value, label in trigger_choices %}
                <option value="{{ value }}">{{ label }}</option>
                {% endfor %}
            </select>
        </div>

        <div class="form-group">
            <label class="form-group-label">{% trans "Channel" %}</label>
            <select name="channel" class="select">
                <option value="email">{% trans "Email" %}</option>
                <option value="whatsapp">{% trans "WhatsApp" %}</option>
                <option value="sms">{% trans "SMS" %}</option>
            </select>
        </div>

        <div class="form-group">
            <label class="form-group-label">{% trans "Template" %}</label>
            <select name="template" class="select">
                <option value="">{% trans "None" %}</option>
                {% for template in templates %}
                <option value="{{ template.id }}">{{ template.name }}</option>
                {% endfor %}
            </select>
        </div>

        <div class="form-group">
            <label class="form-group-label">{% trans "Delay (hours)" %}</label>
            <input type="number" name="delay_hours" class="input" value="0" min="0">
            <p class="text-xs text-base-content/40 mt-1">{% trans "Hours to wait after trigger before sending" %}</p>
        </div>

        <div class="form-group">
            <label class="form-group-label">{% trans "Active" %}</label>
            <input type="checkbox" name="is_active" class="toggle" checked>
        </div>
    </div>

    <div class="side-sheet-footer">
        <button type="button" class="btn btn-ghost btn-sm" @click="closePanel()">{% trans "Cancel" %}</button>
        <button type="submit" class="btn btn-sm color-primary">
            {% icon "save-outline" %}
            {% trans "Create Automation" %}
        </button>
    </div>
</form>
