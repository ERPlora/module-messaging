{% load djicons i18n %}
<div data-back-url="{% url 'messaging:messages' %}" hidden></div>

<div class="p-4">
    <!-- Header -->
    <div class="flex items-center gap-4 mb-6">
        <div class="flex-1">
            <h1 class="text-2xl font-bold">{% trans "Message Detail" %}</h1>
            <div class="flex items-center gap-2 mt-1">
                <span class="badge badge-sm {{ message.status_color }}">{{ message.get_status_display }}</span>
                <span class="text-sm text-base-content/60">{{ message.get_channel_display }}</span>
            </div>
        </div>
    </div>

    <div class="grid grid-cols-1 lg:grid-cols-3 gap-6">
        <!-- Message Content -->
        <div class="lg:col-span-2">
            <div class="card">
                <div class="card-header">
                    <h3 class="card-title">
                        {% icon message.channel_icon css_class="text-primary" %}
                        {% if message.subject %}{{ message.subject }}{% else %}{% trans "Message" %}{% endif %}
                    </h3>
                </div>
                <div class="card-body">
                    <div class="text-sm" style="white-space: pre-wrap;">{{ message.body }}</div>
                </div>
            </div>

            {% if message.error_message %}
            <div class="callout callout-error mt-4">
                <div class="callout-icon">{% icon "alert-circle-outline" %}</div>
                <div class="callout-content">
                    <div class="callout-title">{% trans "Error" %}</div>
                    <div class="callout-text">{{ message.error_message }}</div>
                </div>
            </div>
            {% endif %}
        </div>

        <!-- Message Info -->
        <div class="lg:col-span-1">
            <div class="card mb-4">
                <div class="card-header">
                    <h3 class="card-title">{% icon "information-circle-outline" css_class="text-primary" %} {% trans "Details" %}</h3>
                </div>
                <div class="card-body p-0">
                    <div class="list">
                        <div class="list-item">
                            <div class="list-item-content">
                                <div class="list-item-note">{% trans "Recipient" %}</div>
                                <div class="list-item-label">{{ message.recipient_name|default:"-" }}</div>
                            </div>
                        </div>
                        <div class="list-item">
                            <div class="list-item-content">
                                <div class="list-item-note">{% trans "Contact" %}</div>
                                <div class="list-item-label">{{ message.recipient_contact }}</div>
                            </div>
                        </div>
                        <div class="list-item">
                            <div class="list-item-content">
                                <div class="list-item-note">{% trans "Channel" %}</div>
                                <div class="list-item-label">{{ message.get_channel_display }}</div>
                            </div>
                        </div>
                        {% if message.template %}
                        <div class="list-item">
                            <div class="list-item-content">
                                <div class="list-item-note">{% trans "Template" %}</div>
                                <div class="list-item-label">{{ message.template.name }}</div>
                            </div>
                        </div>
                        {% endif %}
                        {% if message.customer %}
                        <div class="list-item list-item-clickable"
                             hx-get="/m/customers/{{ message.customer.pk }}/"
                             hx-target="#main-content-area"
                             hx-push-url="true">
                            <div class="list-item-content">
                                <div class="list-item-note">{% trans "Customer" %}</div>
                                <div class="list-item-label">{{ message.customer.name }}</div>
                            </div>
                            <div class="list-item-end">
                                <span class="list-item-chevron"></span>
                            </div>
                        </div>
                        {% endif %}
                    </div>
                </div>
            </div>

            <!-- Timestamps -->
            <div class="card">
                <div class="card-header">
                    <h3 class="card-title">{% icon "time-outline" css_class="text-primary" %} {% trans "Timeline" %}</h3>
                </div>
                <div class="card-body p-0">
                    <div class="list">
                        <div class="list-item">
                            <div class="list-item-start">
                                {% icon "create-outline" css_class="text-base-content/40" %}
                            </div>
                            <div class="list-item-content">
                                <div class="list-item-note">{% trans "Created" %}</div>
                                <div class="list-item-label">{{ message.created_at|date:"d/m/Y H:i:s" }}</div>
                            </div>
                        </div>
                        {% if message.sent_at %}
                        <div class="list-item">
                            <div class="list-item-start">
                                {% icon "send-outline" css_class="text-primary" %}
                            </div>
                            <div class="list-item-content">
                                <div class="list-item-note">{% trans "Sent" %}</div>
                                <div class="list-item-label">{{ message.sent_at|date:"d/m/Y H:i:s" }}</div>
                            </div>
                        </div>
                        {% endif %}
                        {% if message.delivered_at %}
                        <div class="list-item">
                            <div class="list-item-start">
                                {% icon "checkmark-done-outline" css_class="text-success" %}
                            </div>
                            <div class="list-item-content">
                                <div class="list-item-note">{% trans "Delivered" %}</div>
                                <div class="list-item-label">{{ message.delivered_at|date:"d/m/Y H:i:s" }}</div>
                            </div>
                        </div>
                        {% endif %}
                        {% if message.read_at %}
                        <div class="list-item">
                            <div class="list-item-start">
                                {% icon "eye-outline" css_class="text-success" %}
                            </div>
                            <div class="list-item-content">
                                <div class="list-item-note">{% trans "Read" %}</div>
                                <div class="list-item-label">{{ message.read_at|date:"d/m/Y H:i:s" }}</div>
                            </div>
                        </div>
                        {% endif %}
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
